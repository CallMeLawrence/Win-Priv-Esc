# good enum starts with a good nmap scan

$ nmap --open -n -p445 10.0.10.0/24

# What we are looking for 
# Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds


$ nmap -p445 --script smb-protocols $target

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
| smb-protocols: 
|   dialects: 
|     NT LM 0.12 (SMBv1) [dangerous, but default]
|     2.02
|     2.10
|     3.00
|_    3.02


# But what if you have some credentials???

$nmap -p445 --script smb-protocols,smb-enum-users,smb-enum-shares --script-args smbusername=administrator,smbpassword=password123 $target

# lots of loots returned like...
Host script results:
| smb-enum-shares: 
|   account_used: administrator
|   \\10.4.18.185\ADMIN$: 
|     Type: STYPE_DISKTREE_HIDDEN
|     Comment: Remote Admin
|     Users: 0
|     Max Users: <unlimited>
|     Path: C:\Windows
|     Anonymous access: <none>
|     Current user access: READ/WRITE
|   \\10.4.18.185\C: 
|     Type: STYPE_DISKTREE
|     Comment: 
|     Users: 0
|     Max Users: <unlimited>
|     Path: C:\
|     Anonymous access: <none>
|     Current user access: READ
|   \\10.4.18.185\C$: 
|     Type: STYPE_DISKTREE_HIDDEN
|     Comment: Default share
|     Users: 0
|     Max Users: <unlimited>
|     Path: C:\
|     Anonymous access: <none>
|     Current user access: READ/WRITE
...

#### SMBMAP ####

# check for guest access
$ smbmap -u guest -p "" -d . -H $target

# It may be fairly common to see something like the following...

[+] Guest session   	IP: 10.4.18.185:445	Name: 10.4.18.185                                       
  Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C                                                 	NO ACCESS	
	C$                                                	NO ACCESS	Default share

# user better creds if you have them

$ smbmap -u administrator -p password123 -d . -H $target
[+] IP: 10.4.18.185:445	Name: 10.4.18.185                                       
  Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	READ, WRITE	Remote Admin
	C                                                 	READ ONLY	
	C$                                                	READ, WRITE	Default share
	D$                                                	READ, WRITE	Default share




